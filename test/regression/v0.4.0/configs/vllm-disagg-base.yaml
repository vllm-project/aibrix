# VLLM disaggregated base config
# Use helm --set to customize: model.name, model.path, model.tensorParallel, resources.gpu.count, workers.prefill.replicas, workers.decode.replicas

engine:
  type: "vllm"
  image: "kvcache-container-image-hb2-cn-beijing.cr.volces.com/aibrix/vllm-openai:v0.10.0-cu128-nixl-v0.4.1-lmcache-0.3.2"

model:
  name: "qwen3-8b"          # Override with --set model.name=qwen3-32b
  path: "/models/Qwen3-8B"  # Override with --set model.path=/models/Qwen3-32B
  tensorParallel: 1         # Override with --set model.tensorParallel=2

deployment:
  type: "disaggregated"

router:
  enabled: true
  image: "kvcache-container-image-hb2-cn-beijing.cr.volces.com/aibrix/vllm-openai:v0.10.0-cu128-nixl-v0.4.1-lmcache-0.3.2"

workers:
  prefill:
    replicas: 1             # Override with --set workers.prefill.replicas=2,4
  decode:
    replicas: 1             # Override with --set workers.decode.replicas=1,2

network:
  hostNetwork: false
  rdma:
    enabled: true
    cniName: "rdma"

resources:
  gpu: 1                # Override with --set resources.gpu=2 for 32B
  rdma: 1               # Override with --set resources.rdma=1
  memory:
    sharedMemory: true

volumes:
  models:
    hostPath: "/data01/models"

env:
  - name: GLOO_SOCKET_IFNAME
    value: "eth0"
  - name: NCCL_SOCKET_IFNAME
    value: "eth0"
  - name: NCCL_IB_DISABLE
    value: "0"
  - name: NCCL_IB_GID_INDEX
    value: "7"
  - name: NCCL_DEBUG
    value: "INFO"

security:
  privileged: true
  capabilities:
    - IPC_LOCK