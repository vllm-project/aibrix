# This patch contains the TOS object store configuration for the metadata service
# !!Important: Please make sure aibrix-tos-credentials secret exists in both aibrix-system and default namespaces.
apiVersion: apps/v1
kind: Deployment
metadata:
  name: metadata-service
  namespace: aibrix-system
spec:
  template:
    spec:
      containers:
      - name: metadata-service
        command: 
          - aibrix_metadata
          - --host
          - "0.0.0.0"
          - --enable-k8s-job
          - --k8s-job-patch
          - /app/config/job_template_patch.yaml
        env:
          - name: STORAGE_TOS_ACCESS_KEY
            valueFrom:
            secretKeyRef:
              name: aibrix-tos-credentials
              key: access-key
          - name: STORAGE_TOS_SECRET_KEY
            valueFrom:
              secretKeyRef:
                name: aibrix-tos-credentials
                key: secret-key
          - name: STORAGE_TOS_ENDPOINT
            valueFrom:
              secretKeyRef:
                name: aibrix-tos-credentials
                key: endpoint
          - name: STORAGE_TOS_REGION
            valueFrom:
              secretKeyRef:
                name: aibrix-tos-credentials
                key: region
          - name: STORAGE_TOS_BUCKET
            valueFrom:
              secretKeyRef:
                name: aibrix-tos-credentials
                key: bucket-name